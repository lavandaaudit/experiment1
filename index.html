<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>IBONIRIUM ¬∑ Terrarium ¬∑ EXP-01</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{
  width:100%;
  height:100%;
  background:#000;
  overflow:hidden;
  font-family:monospace;
}
canvas{position:fixed;inset:0}

#info{
  position:fixed;
  top:12px;
  left:12px;
  color:#9affc2;
  font-size:12px;
  line-height:1.4;
  z-index:5;
}

#panel{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  height:200px;
  padding:12px 16px;
  font-size:12px;
  color:#c7ffd9;
  background:linear-gradient(to top,rgba(0,0,0,0.85),rgba(0,0,0,0.2));
  z-index:6;
  line-height:1.45;
  overflow-y:auto;
}
</style>
</head>
<body>

<canvas id="stars"></canvas>
<canvas id="terrarium"></canvas>
<canvas id="sensors"></canvas>

<div id="info">
<b>IBONIRIUM ¬∑ LAB TERRARIUM ¬∑ EXP-01</b><br>
Phase: <span id="phase">‚Äì</span><br>
Day: <span id="day">‚Äì</span><br>
Solar SSN: <span id="ssn">‚Äì</span><br>
Solar Factor: <span id="sf">‚Äì</span><br>
Growth Energy: <span id="ge">‚Äì</span>
</div>

<div id="panel">
<b>–ü–ê–ù–ï–õ–¨ –ö–ï–†–£–í–ê–ù–ù–Ø ¬∑ EXP-01</b><br>
–ü–µ—Ä—ñ–æ–¥: <span id="period"></span><br>
–î–µ–Ω—å —Ü–∏–∫–ª—É: <span id="cycleDay"></span><br>
–§–∞–∑–∞: <b><span id="phasePanel"></span></b><br><br>

<b>‚òÄÔ∏è –°–æ–Ω—è—á–Ω–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</b><br>
SSN: <span id="p_ssn">‚Äì</span><br>
Solar Factor: <span id="p_sf">‚Äì</span><br><br>

<b>üåç –ó–µ–º–ª—è</b><br>
–¢–µ–º–ø. –ø–æ–≤—ñ—Ç—Ä—è: <span id="airTemp">‚Äì</span> ¬∞C<br>
–í–æ–ª–æ–≥—ñ—Å—Ç—å –ø–æ–≤—ñ—Ç—Ä—è: <span id="airHum">‚Äì</span> %<br>
–¢–µ–º–ø. “ë—Ä—É–Ω—Ç—É: <span id="soilTemp">‚Äì</span> ¬∞C<br>
–í–æ–ª–æ–≥—ñ—Å—Ç—å “ë—Ä—É–Ω—Ç—É: <span id="soilHum">‚Äì</span> %<br><br>

<b>üå± –°–∏—Å—Ç–µ–º–∞</b><br>
Growth Energy: <span id="p_ge">‚Äì</span><br>
Density: <span id="density">‚Äì</span><br>
Mutation: <span id="mutation">‚Äì</span><br><br>

<i id="systemState">–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–µ—Ä–∞—Ä—ñ—É–º—É‚Ä¶</i>
</div>

<script>
/* ===== CANVAS SETUP ===== */
const starCanvas=document.getElementById('stars');
const tCanvas=document.getElementById('terrarium');
const sensorCanvas=document.getElementById('sensors');
const sctx=starCanvas.getContext('2d');
const tctx=tCanvas.getContext('2d');
const scx=sensorCanvas.getContext('2d');

function resize(){
  starCanvas.width=tCanvas.width=sensorCanvas.width=innerWidth;
  starCanvas.height=tCanvas.height=innerHeight;
  sensorCanvas.height=180;
}
addEventListener('resize',resize);resize();

/* ===== DATES ===== */
const START_DATE=new Date();
const STOP_DATE=new Date('2026-12-13');

/* ===== STAR FIELD ===== */
const stars=Array.from({length:240},()=>({x:Math.random(),y:Math.random(),z:Math.random()}));
function drawStars(){
  sctx.clearRect(0,0,starCanvas.width,starCanvas.height);
  stars.forEach(st=>{
    st.y+=0.00025*(1+st.z);
    if(st.y>1)st.y=0;
    sctx.globalAlpha=0.3+st.z*0.6;
    sctx.fillStyle="#fff";
    sctx.beginPath();
    sctx.arc(st.x*starCanvas.width,st.y*starCanvas.height,st.z*1.4,0,Math.PI*2);
    sctx.fill();
  });
  sctx.globalAlpha=1;
}

/* ===== NOISE ===== */
function noise(x,y){return Math.sin(x*12.989+y*78.233)*43758.5453%1;}

/* ===== ENV ===== */
let solarFactor=1,solarSSN=0,growthEnergy=1,density=1,mutation=0;

/* ===== GRASS ===== */
const grass=Array.from({length:900},()=>({x:Math.random(),h:0.3+Math.random()*0.7,p:Math.random()*Math.PI*2}));
function drawGrass(){
  grass.forEach(g=>{
    const x=g.x*tCanvas.width;
    const base=tCanvas.height*0.75+noise(g.x,0)*40;
    const sway=Math.sin(Date.now()*0.001+g.p)*6;
    const h=g.h*120*solarFactor;
    tctx.strokeStyle='rgba(90,220,140,0.6)';
    tctx.lineWidth=1;
    tctx.beginPath();
    tctx.moveTo(x,base);
    tctx.quadraticCurveTo(x+sway,base-h*0.5,x,base-h);
    tctx.stroke();
  });
}

/* ===== FLOWERS ===== */
class Flower{
  constructor(x){this.x=x;this.stage=0;this.max=3+Math.random()*3;}
  grow(){this.stage+=0.002*growthEnergy;}
  draw(){
    let x=this.x,y=tCanvas.height*0.75;
    let len=40,angle=-Math.PI/2;
    tctx.strokeStyle='rgba(255,160,210,0.8)';
    for(let i=0;i<Math.floor(this.stage);i++){
      const nx=x+Math.cos(angle)*len;
      const ny=y+Math.sin(angle)*len;
      tctx.beginPath();tctx.moveTo(x,y);tctx.lineTo(nx,ny);tctx.stroke();
      angle+=(noise(i,this.x)-0.5)*mutation;
      x=nx;y=ny;len*=0.7;
    }
    if(this.stage>this.max){tctx.fillStyle='rgba(255,200,230,0.8)';tctx.beginPath();tctx.arc(x,y,5,0,Math.PI*2);tctx.fill();}
  }
}
let flowers=Array.from({length:40},()=>new Flower(Math.random()*innerWidth));

/* ===== NOAA SOLAR ===== */
async function updateSolar(){
  try{
    const r=await fetch('https://services.swpc.noaa.gov/json/solar-cycle/predicted-solar-cycle.json');
    const d=await r.json();
    const l=d[d.length-1];
    solarSSN=l.predicted_ssn;
    solarFactor=Math.min(3,0.6+solarSSN/120);
    growthEnergy=solarFactor*(0.8+Math.random()*0.2);
    density=0.6+solarFactor/3;
    mutation=solarFactor/2;

    ssn.textContent=solarSSN.toFixed(1);
    sf.textContent=solarFactor.toFixed(2);
    ge.textContent=growthEnergy.toFixed(2);
    p_ssn.textContent=solarSSN.toFixed(1);
    p_sf.textContent=solarFactor.toFixed(2);
    p_ge.textContent=growthEnergy.toFixed(2);
    densityEl.textContent=density.toFixed(2);
    mutationEl.textContent=mutation.toFixed(2);
  }catch(e){}
}
updateSolar();setInterval(updateSolar,1800000);

/* ===== EARTH DATA ===== */
async function updateEarth(){
  try{
    const r=await fetch('https://api.open-meteo.com/v1/forecast?latitude=50&longitude=30&hourly=temperature_2m,relative_humidity_2m,soil_temperature_0cm,soil_moisture_0_1cm&timezone=auto');
    const d=await r.json();
    const i=d.hourly.time.length-1;
    airTemp.textContent=d.hourly.temperature_2m[i].toFixed(1);
    airHum.textContent=d.hourly.relative_humidity_2m[i].toFixed(0);
    soilTemp.textContent=d.hourly.soil_temperature_0cm[i].toFixed(1);
    soilHum.textContent=(d.hourly.soil_moisture_0_1cm[i]*100).toFixed(0);
  }catch(e){}
}
updateEarth();setInterval(updateEarth,1800000);

/* ===== CYCLE & PHASE ===== */
function updateCycle(){
  const now=new Date();
  const day=Math.floor((now-START_DATE)/86400000);
  dayEl.textContent=Math.max(0,day);
  cycleDay.textContent=Math.max(0,day);
  phase.textContent=now<STOP_DATE?'Growth':'Final';
  phasePanel.textContent=phase.textContent;
  period.textContent=START_DATE.toDateString()+' ‚Üí '+STOP_DATE.toDateString();
}
setInterval(updateCycle,60000);updateCycle();

/* ===== SYSTEM STATE ===== */
function updateState(){
  let s='–°—Ç–∞–±—ñ–ª—å–Ω–∏–π –±—ñ–æ—Ä–∏—Ç–º.';
  if(solarFactor>2)s='–§–æ—Ç–æ–Ω–Ω–µ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∏–π —Ä—ñ—Å—Ç.';
  if(growthEnergy<0.8)s='–ó–∞–≥–∞–ª—å–º–æ–≤–∞–Ω–∏–π —Ä–æ–∑–≤–∏—Ç–æ–∫.';
  systemState.textContent=s;
}
setInterval(updateState,10000);

/* ===== LOOP ===== */
function loop(){
  drawStars();
  if(new Date()<STOP_DATE){
    tctx.clearRect(0,0,tCanvas.width,tCanvas.height);
    drawGrass();
    flowers.forEach(f=>{f.grow();f.draw()});
  }
  requestAnimationFrame(loop);
}
loop();

/* ===== FINAL FIX ===== */
function checkFinal(){
  if(new Date()>=STOP_DATE){
    const img=tCanvas.toDataURL('image/jpeg',0.92);
    console.log('EXPERIMENT FIXED',img);
    alert("–ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –¢–µ—Ä–∞—Ä—ñ—É–º –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ.");
  }
}
setInterval(checkFinal,60000);
</script>
</body>
</html>
